<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Timer Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #3b6546;
            --card-bg: #1f1f1f;
            --input-bg: #2d2d2d;
            --text-color: #ffffff;
            --accent-color: #1db954;
            --danger-color: #e74c3c;
            --secondary-text: #a0a0a0;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background 0.5s;
        }

        /* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠØ© --- */
        .header-controls {
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            margin-bottom: 20px;
        }

        .focus-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: 0.3s;
        }
        .focus-btn:hover { background: rgba(255,255,255,0.25); }

        /* Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² */
        .exit-focus-btn {
            display: none;
            background: var(--danger-color);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            font-family: 'Cairo', sans-serif;
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 9999;
        }
        .exit-focus-btn:hover {
            background: #c0392b;
        }

        /* --- Ø§Ù„Ø³Ø§Ø¹Ø© --- */
        .clock-container {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        .big-clock {
            font-size: 5rem;
            font-weight: 700;
            font-family: 'Segoe UI', sans-serif;
            letter-spacing: 2px;
            text-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .date-badge {
            background: rgba(255,255,255,0.1);
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --- */
        .nav-pill {
            background: rgba(0,0,0,0.2);
            padding: 5px;
            border-radius: 12px;
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
        }
        .nav-pill button {
            background: transparent;
            border: none;
            color: #ccc;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            transition: 0.3s;
        }
        .nav-pill button:hover {
            background: rgba(255,255,255,0.1);
        }
        .nav-pill button.active {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 4px 10px rgba(29, 185, 84, 0.3);
        }

        /* --- Ø§Ù„ØªØ®Ø·ÙŠØ· --- */
        .main-layout {
            display: grid;
            grid-template-columns: 300px 450px;
            gap: 20px;
            width: 100%;
            max-width: 800px;
            justify-content: center;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* --- ÙƒØ§Ø±Øª Ø§Ù„Ø£ØµÙˆØ§Øª --- */
        .sound-item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .sound-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sound-label { display: flex; align-items: center; gap: 8px; font-size: 0.95rem; }
        
        /* Ø²Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª */
        .play-btn {
            background: transparent;
            border: 1px solid #555;
            color: #aaa;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .play-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        .play-btn.playing {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-color);
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            background: #444;
            border-radius: 2px;
            -webkit-appearance: none;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* --- ÙƒØ§Ø±Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª --- */
        .main-card { text-align: center; }
        .grid-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        .input-box {
            background: var(--input-bg);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .input-box label {
            font-size: 0.85rem;
            color: #aaa;
        }
        .input-box input[type="number"] {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            width: 100%;
            font-family: 'Segoe UI', sans-serif;
        }
        .input-box input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .btn-action {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            font-family: 'Cairo', sans-serif;
            transition: 0.3s;
        }
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .btn-action.start { background: var(--accent-color); color: white; }
        .btn-action.pause { background: #f1c40f; color: #1e1e1e; }
        
        .timer-running {
            font-size: 6rem;
            color: var(--accent-color);
            font-family: 'Segoe UI', sans-serif;
            margin: 20px 0;
            font-weight: bold;
        }

        /* --- ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² --- */
        body.focus-active {
            justify-content: center;
            padding: 0;
        }
        body.focus-active .main-layout, 
        body.focus-active .nav-pill,
        body.focus-active .header-controls,
        body.focus-active .date-badge {
            display: none !important;
        }
        
        body.focus-active .exit-focus-btn {
            display: block;
        }

        body.focus-active .clock-container {
            position: fixed;
            top: 35%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin: 0;
        }
        body.focus-active .big-clock {
            font-size: 8rem;
            opacity: 0.9;
        }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ/Ø§Ù„Ù…Ø¤Ù‚Øª ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² */
        .focus-timer-display {
            display: none !important; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            position: fixed;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 20px 40px;
        }
        
        body.focus-active .focus-timer-display.active {
            display: block !important; /* ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† active */
        }
        
        .focus-timer-display .timer-text {
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--accent-color);
            font-family: 'Segoe UI', sans-serif;
            margin-bottom: 8px;
        }
        
        .focus-timer-display .timer-label {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 8px;
        }
        
        .focus-timer-display .timer-cycle {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }
        
        .focus-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .focus-control-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-size: 0.9rem;
            transition: 0.3s;
        }
        
        .focus-control-btn:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .focus-control-btn.pause-btn {
            background: rgba(241, 196, 15, 0.2);
            border-color: rgba(241, 196, 15, 0.4);
        }
        
        .focus-control-btn.stop-btn {
            background: rgba(231, 76, 60, 0.2);
            border-color: rgba(231, 76, 60, 0.4);
        }

        /* Ø§Ù„Ø£Ø°ÙƒØ§Ø± */
        .athkar-container {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.8rem;
            text-align: center;
            color: #f1c40f;
            opacity: 0;
            transition: opacity 1s;
            pointer-events: none;
            width: 90%;
            max-width: 600px;
        }
        body.focus-active .athkar-container { opacity: 1; }

        /* Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² */
        .focus-prayer-display {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: left;
            direction: rtl;
        }
        
        body.focus-active .focus-prayer-display {
            display: block;
        }
        
        #focus-prayer-content {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }
        
        #focus-next-prayer-name {
            color: var(--accent-color);
            font-weight: bold;
        }
        
        #focus-next-prayer-time {
            color: white;
            font-family: 'Segoe UI', sans-serif;
            font-weight: bold;
        }

        .hidden { display: none !important; }

        /* ØªØ­Ø³ÙŠÙ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
        #task-input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: #2d2d2d;
            color: white;
            font-family: 'Cairo', sans-serif;
        }
        
        .task-add-btn {
            background: var(--accent-color);
            border: none;
            border-radius: 8px;
            width: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            color: white;
            transition: 0.3s;
        }
        .task-add-btn:hover {
            background: #17a042;
        }

        .task-item {
            background: rgba(255,255,255,0.1);
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: 0.3s;
        }
        .task-item:hover {
            background: rgba(255,255,255,0.15);
        }
        .task-text {
            cursor: pointer;
            flex: 1;
            text-align: right;
        }
        .task-text.completed {
            text-decoration: line-through;
            opacity: 0.5;
        }
        .task-delete-btn {
            background: var(--danger-color);
            border: none;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.3s;
        }
        .task-delete-btn:hover {
            background: #c0392b;
        }

        /* --- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª --- */
        .stat-card {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent-color);
            font-family: 'Segoe UI', sans-serif;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
        }

        #stats-view h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        /* --- Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© --- */
        .prayer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            transition: 0.3s;
        }
        
        .prayer-item:hover {
            background: rgba(255,255,255,0.08);
        }
        
        .prayer-item.active {
            background: rgba(29, 185, 84, 0.2);
            border: 1px solid rgba(29, 185, 84, 0.4);
        }
        
        .prayer-name {
            font-weight: 600;
            color: #ddd;
        }
        
        .prayer-item.active .prayer-name {
            color: var(--accent-color);
        }
        
        .prayer-time {
            font-family: 'Segoe UI', sans-serif;
            color: #aaa;
            font-weight: bold;
        }
        
        .prayer-item.active .prayer-time {
            color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            .big-clock { font-size: 3.5rem; }
            body.focus-active .big-clock { font-size: 4.5rem; }
            .athkar-container { font-size: 1.4rem; }
            .timer-running { font-size: 4rem; }
            .header-controls {
                padding: 0 10px;
            }
            
            /* Ø¥ØµÙ„Ø§Ø­ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            body.focus-active .clock-container {
                top: 30%;
            }
            
            body.focus-active .big-clock {
                font-size: 4rem;
            }
            
            .focus-timer-display {
                top: 55%;
                padding: 15px 25px;
            }
            
            .focus-timer-display .timer-text {
                font-size: 2.5rem;
            }
            
            .focus-timer-display .timer-label {
                font-size: 0.9rem;
            }
            
            .focus-timer-display .timer-cycle {
                font-size: 0.85rem;
            }
            
            .focus-control-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            body.focus-active .athkar-container {
                bottom: 50px;
                font-size: 1.2rem;
            }
            
            /* Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² - Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            .focus-prayer-display {
                top: 10px;
                left: 10px;
                right: auto;
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            #focus-prayer-content {
                font-size: 0.95rem;
            }
            
            #focus-time-until {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>

    <button class="exit-focus-btn" onclick="toggleFocusMode()">âœ• Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØªØ±ÙƒÙŠØ²</button>

    <div class="header-controls">
        <button class="focus-btn" onclick="toggleFocusMode()">âœ¨ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²</button>
    </div>

    <div class="clock-container">
        <div class="big-clock" id="clock">00:00:00</div>
        <div class="date-badge" id="date">--</div>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ/Ø§Ù„Ù…Ø¤Ù‚Øª ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² -->
    <div class="focus-timer-display" id="focus-timer-display">
        <div class="timer-label" id="focus-timer-label">ğŸ¯ ÙˆÙ‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²</div>
        <div class="timer-text" id="focus-timer-text">25:00</div>
        <div class="timer-cycle" id="focus-timer-cycle"></div>
        <div class="focus-controls">
            <button class="focus-control-btn pause-btn" id="focus-pause-btn" onclick="togglePausePomo()">â¸ Ø¥ÙŠÙ‚Ø§Ù</button>
            <button class="focus-control-btn stop-btn" onclick="stopFocusTimer()">â¹ Ø¥Ù†Ù‡Ø§Ø¡</button>
        </div>
    </div>

    <div class="nav-pill">
        <button class="active" onclick="switchTab('pomo')" id="btn-pomo">â° Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ</button>
        <button onclick="switchTab('timer')" id="btn-timer">â³ Ù…Ø¤Ù‚Øª</button>
        <button onclick="switchTab('tasks')" id="btn-tasks">ğŸ“ Ø§Ù„Ù…Ù‡Ø§Ù…</button>
        <button onclick="switchTab('stats')" id="btn-stats">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
    </div>

    <div class="main-layout" id="main-content">
        
        <div class="sidebar">
            <!-- Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© -->
            <div class="card" style="margin-bottom: 15px;">
                <div style="color:#aaa; margin-bottom:15px; font-weight:bold; display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ•Œ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</span>
                    <button onclick="refreshPrayerTimes()" style="background: transparent; border: none; color: #aaa; cursor: pointer; font-size: 1.2rem;" title="ØªØ­Ø¯ÙŠØ«">ğŸ”„</button>
                </div>
                
                <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© -->
                <div style="margin-bottom: 15px;">
                    <select id="city-select" onchange="getPrayerTimesByCity()" style="width: 100%; padding: 10px; border-radius: 8px; background: var(--input-bg); color: white; border: 1px solid #444; font-family: 'Cairo', sans-serif;">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                        <option value="Cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
                        <option value="Alexandria">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                        <option value="Giza">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
                        <option value="Shubra El Kheima">Ø´Ø¨Ø±Ø§ Ø§Ù„Ø®ÙŠÙ…Ø©</option>
                        <option value="Port Said">Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯</option>
                        <option value="Suez">Ø§Ù„Ø³ÙˆÙŠØ³</option>
                        <option value="Luxor">Ø§Ù„Ø£Ù‚ØµØ±</option>
                        <option value="Mansoura">Ø§Ù„Ù…Ù†ØµÙˆØ±Ø©</option>
                        <option value="Tanta">Ø·Ù†Ø·Ø§</option>
                        <option value="Asyut">Ø£Ø³ÙŠÙˆØ·</option>
                        <option value="Ismailia">Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©</option>
                        <option value="Fayyum">Ø§Ù„ÙÙŠÙˆÙ…</option>
                        <option value="Zagazig">Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚</option>
                        <option value="Aswan">Ø£Ø³ÙˆØ§Ù†</option>
                        <option value="Damietta">Ø¯Ù…ÙŠØ§Ø·</option>
                        <option value="Damanhur">Ø¯Ù…Ù†Ù‡ÙˆØ±</option>
                        <option value="Minya">Ø§Ù„Ù…Ù†ÙŠØ§</option>
                        <option value="Beni Suef">Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ</option>
                        <option value="Qena">Ù‚Ù†Ø§</option>
                        <option value="Sohag">Ø³ÙˆÙ‡Ø§Ø¬</option>
                    </select>
                    <div style="margin-top: 8px; text-align: center;">
                        <button onclick="getPrayerTimes()" style="background: rgba(255,255,255,0.1); color: #aaa; border: 1px solid #444; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-family: 'Cairo', sans-serif;">
                            ğŸ“ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
                        </button>
                    </div>
                </div>
                
                <div id="prayer-times-container">
                    <div style="text-align: center; color: #666; padding: 20px;">
                        <div style="margin-bottom: 10px;">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡</div>
                    </div>
                </div>
                
                <!-- Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© -->
                <div id="next-prayer-info" style="display: none; background: rgba(29, 185, 84, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; border: 1px solid rgba(29, 185, 84, 0.3);">
                    <div style="font-size: 0.85rem; color: #aaa; margin-bottom: 5px;">Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span id="next-prayer-name" style="font-weight: bold; color: var(--accent-color);">Ø§Ù„ÙØ¬Ø±</span>
                        <span id="next-prayer-time" style="font-weight: bold;">05:30</span>
                    </div>
                    <div id="time-until-prayer" style="font-size: 0.8rem; color: #888; margin-top: 5px;">Ø¨Ø¹Ø¯ 3 Ø³Ø§Ø¹Ø§Øª</div>
                </div>
            </div>

            <div class="card">
                <div style="color:#aaa; margin-bottom:15px; font-weight:bold;">ğŸ”Š Ø£ØµÙˆØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©</div>
                

                <div class="sound-item">
                    <div class="sound-header-row">
                        <div class="sound-label">âš¡ ØµÙˆØª 1</div>
                        <button class="play-btn" id="btn-thunder" onclick="toggleSound('thunder')">â–¶</button>
                    </div>
                    <input type="range" min="0" max="1" step="0.1" value="0.5" oninput="setVolume('thunder', this.value)">
                </div>


                <div style="margin: 15px 0; border-top: 1px solid rgba(255,255,255,0.1);"></div>
                
                <div style="color:#aaa; margin-bottom:15px; font-weight:bold;">ğŸ“» Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
                
                <div class="sound-item">
                    <div class="sound-header-row">
                        <div class="sound-label">ğŸ•Œ Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† - Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</div>
                        <button class="play-btn" id="btn-quran" onclick="toggleQuranRadio()">â–¶</button>
                    </div>
                    <input type="range" min="0" max="1" step="0.1" value="0.7" oninput="setQuranVolume(this.value)">
                </div>
            </div>

            <div class="card" style="margin-top:15px; font-size:0.9rem; color:#ccc; line-height:1.6;">
                ğŸ”” <b>ØªÙ„Ù…ÙŠØ­:</b> Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ØŒ Ø³ØªØ®ØªÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ³ØªØ¸Ù‡Ø± Ù„Ùƒ Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø¨Ø´ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©.
            </div>
        </div>

        <div class="card main-card">
            
            <div id="pomo-view">
                <div id="pomo-setup">
                    <h2>ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¬Ù„Ø³Ø©</h2>
                    <div class="grid-inputs">
                        <div class="input-box">
                            <label>Ø§Ù„ØªØ±ÙƒÙŠØ² (Ø¯Ù‚ÙŠÙ‚Ø©)</label>
                            <input type="number" id="p_focus" value="25" min="1" max="120">
                        </div>
                        <div class="input-box">
                            <label>Ø§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ù‚ØµÙŠØ±Ø© (Ø¯Ù‚ÙŠÙ‚Ø©)</label>
                            <input type="number" id="p_short" value="5" min="1" max="60">
                        </div>
                        <div class="input-box">
                            <label>Ø§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ø·ÙˆÙŠÙ„Ø© (Ø¯Ù‚ÙŠÙ‚Ø©)</label>
                            <input type="number" id="p_long" value="15" min="5" max="60">
                        </div>
                        <div class="input-box" style="justify-content:center; cursor:pointer;" onclick="toggleCheckbox()">
                            <label>Ø§Ù†ØªÙ‚Ø§Ù„ Ø¢Ù„ÙŠ</label>
                            <input type="checkbox" id="p_auto" checked>
                        </div>
                        <div class="input-box">
                            <label>Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ø·ÙˆÙŠÙ„Ø©</label>
                            <input type="number" id="p_cycles" value="4" min="1" max="20">
                        </div>
                    </div>
                    <button class="btn-action start" onclick="startPomo()">
                        <span>â–¶</span> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬Ù„Ø³Ø©
                    </button>
                </div>

                <div id="pomo-running" class="hidden">
                    <div id="p_status_text" style="color:#aaa; font-size:1.2rem;">ğŸ¯ ÙˆÙ‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²</div>
                    <div class="timer-running" id="p_timer_display">25:00</div>
                    <div style="margin-bottom:20px; color:#888;">Ø¯ÙˆØ±Ø©: <span id="cycle_display">1/4</span></div>
                    
                    <div style="display:flex; gap:10px; margin-bottom: 10px;">
                        <button class="btn-action pause" onclick="togglePausePomo()" id="p_pause_btn">â¸ Ø¥ÙŠÙ‚Ø§Ù</button>
                        <button class="btn-action" style="background:var(--danger-color); color:white;" onclick="resetPomo()">â¹ Ø¥Ù†Ù‡Ø§Ø¡</button>
                    </div>
                </div>
            </div>

            <div id="timer-view" class="hidden">
                <h2>Ù…Ø¤Ù‚Øª ØªÙ†Ø§Ø²Ù„ÙŠ</h2>
                <div class="grid-inputs" id="timer-setup">
                    <div class="input-box"><label>Ø¯Ù‚Ø§Ø¦Ù‚</label><input type="number" id="t_min" value="10" min="0" max="999"></div>
                    <div class="input-box"><label>Ø«ÙˆØ§Ù†ÙŠ</label><input type="number" id="t_sec" value="0" min="0" max="59"></div>
                </div>
                <div id="timer-running-display" class="hidden">
                    <div class="timer-running" id="t_display">00:00</div>
                </div>
                <button class="btn-action start" onclick="handleTimerBtn()" id="t_action_btn">â–¶ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¤Ù‚Øª</button>
            </div>

            <div id="tasks-view" class="hidden">
                <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="text" id="task-input" placeholder="Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©...">
                    <button onclick="addTask()" class="task-add-btn">+</button>
                </div>
                <ul id="task-list" style="list-style:none; padding:0; text-align:right;"></ul>
            </div>

            <div id="stats-view" class="hidden">
                <h2>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
                
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ… -->
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="margin-top:0; color: var(--accent-color);">ğŸ“… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="stat-card">
                            <div class="stat-value" id="today-cycles">0</div>
                            <div class="stat-label">Ø¯ÙˆØ±Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="today-time">0</div>
                            <div class="stat-label">Ø¯Ù‚ÙŠÙ‚Ø© ØªØ±ÙƒÙŠØ²</div>
                        </div>
                    </div>
                </div>

                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ -->
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="margin-top:0; color: #f1c40f;">ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="stat-card">
                            <div class="stat-value" id="week-cycles">0</div>
                            <div class="stat-label">Ø¯ÙˆØ±Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="week-time">0</div>
                            <div class="stat-label">Ø¯Ù‚ÙŠÙ‚Ø© ØªØ±ÙƒÙŠØ²</div>
                        </div>
                    </div>
                </div>

                <!-- Streak -->
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                    <h3 style="margin-top:0; color: #e74c3c;">ğŸ”¥ Ø§Ù„Ø³Ù„Ø³Ù„Ø©</h3>
                    <div class="stat-value" id="streak-days" style="font-size: 3rem;">0</div>
                    <div class="stat-label">ÙŠÙˆÙ… Ù…ØªØªØ§Ù„ÙŠ</div>
                </div>

                <!-- Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© -->
                <button class="btn-action" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" onclick="shareAchievement()">
                    <span>ğŸ“¤</span> Ø´Ø§Ø±Ùƒ Ø¥Ù†Ø¬Ø§Ø²Ùƒ
                </button>

                <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† -->
                <button class="btn-action" style="background: var(--danger-color); margin-top: 10px;" onclick="resetStats()">
                    <span>ğŸ”„</span> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                </button>
            </div>
        </div>
    </div>

    <div id="athkar-box" class="athkar-container">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² -->
    <div id="focus-prayer-display" class="focus-prayer-display">
        <div id="focus-prayer-content">
            <span id="focus-next-prayer-name">Ø§Ù„ÙØ¬Ø±</span>
            <span id="focus-next-prayer-time">05:31</span>
        </div>
        <div id="focus-time-until" style="font-size: 0.9rem; color: #aaa; margin-top: 5px;">Ø¨Ø¹Ø¯ 9 Ø³Ø§Ø¹Ø© Ùˆ 53 Ø¯Ù‚ÙŠÙ‚Ø©</div>
    </div>



    <script>
        // --- Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… ---
        let quranRadio = null;
        let quranPlaying = false;

        function toggleQuranRadio() {
            const btn = document.getElementById('btn-quran');
            
            if (!quranPlaying) {
                // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©
                if (!quranRadio) {
                    quranRadio = new Audio('https://n0c.radiojar.com/8s5u5tpdtwzuv?rj-ttl=5&rj-tok=AAABm57nFpkAHR1sjOtZixFuqQ');
                    quranRadio.volume = 0.7;
                }
                
                quranRadio.play().then(() => {
                    quranPlaying = true;
                    btn.innerHTML = "â¸";
                    btn.classList.add('playing');
                }).catch(error => {
                    console.error('Error playing Quran radio:', error);
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£ÙˆÙ„
                    quranRadio.src = 'https://stream.radiojar.com/8s5u5tpdtwzuv';
                    quranRadio.play().then(() => {
                        quranPlaying = true;
                        btn.innerHTML = "â¸";
                        btn.classList.add('playing');
                    }).catch(e => {
                        alert('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                    });
                });
            } else {
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©
                if (quranRadio) {
                    quranRadio.pause();
                    quranPlaying = false;
                    btn.innerHTML = "â–¶";
                    btn.classList.remove('playing');
                }
            }
        }

        function setQuranVolume(value) {
            if (quranRadio) {
                quranRadio.volume = parseFloat(value);
            }
        }

        // --- Ù†Ø¸Ø§Ù… Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ---
        let prayerTimes = null;
        let prayerCheckInterval = null;
        let lastNotificationTime = null;
        let nextPrayerData = { name: '', time: '', minutesLeft: 0 };
        
        const prayerNames = {
            Fajr: 'Ø§Ù„ÙØ¬Ø±',
            Dhuhr: 'Ø§Ù„Ø¸Ù‡Ø±',
            Asr: 'Ø§Ù„Ø¹ØµØ±',
            Maghrib: 'Ø§Ù„Ù…ØºØ±Ø¨',
            Isha: 'Ø§Ù„Ø¹Ø´Ø§Ø¡'
        };

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
        async function getPrayerTimesByCity() {
            const citySelect = document.getElementById('city-select');
            const city = citySelect.value;
            
            if (!city) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©');
                return;
            }
            
            try {
                const date = new Date();
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© (method=5) Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙˆÙ‚Ø§Øª Ø£Ø¯Ù‚
                const response = await fetch(
                    `https://api.aladhan.com/v1/timingsByCity/${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}?city=${city}&country=Egypt&method=5`
                );
                
                const data = await response.json();
                
                if (data.code === 200) {
                    prayerTimes = data.data.timings;
                    displayPrayerTimes();
                    
                    // Ø­ÙØ¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
                    localStorage.setItem('selectedCity', city);
                    
                    // Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„ØµÙ„ÙˆØ§Øª
                    if (prayerCheckInterval) clearInterval(prayerCheckInterval);
                    prayerCheckInterval = setInterval(checkUpcomingPrayer, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
                    checkUpcomingPrayer(); // ÙØ­Øµ ÙÙˆØ±ÙŠ
                }
            } catch (error) {
                console.error('Error fetching prayer times:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©');
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        async function getPrayerTimes() {
            if (!navigator.geolocation) {
                alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    try {
                        const date = new Date();
                        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© (method=5)
                        const response = await fetch(
                            `https://api.aladhan.com/v1/timings/${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}?latitude=${lat}&longitude=${lng}&method=5`
                        );
                        
                        const data = await response.json();
                        
                        if (data.code === 200) {
                            prayerTimes = data.data.timings;
                            displayPrayerTimes();
                            
                            // Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                            localStorage.setItem('prayerLocation', JSON.stringify({ lat, lng }));
                            document.getElementById('city-select').value = '';
                            
                            // Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„ØµÙ„ÙˆØ§Øª
                            if (prayerCheckInterval) clearInterval(prayerCheckInterval);
                            prayerCheckInterval = setInterval(checkUpcomingPrayer, 60000);
                            checkUpcomingPrayer();
                        }
                    } catch (error) {
                        console.error('Error fetching prayer times:', error);
                        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©');
                    }
                },
                (error) => {
                    alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹');
                }
            );
        }

        // Ø¹Ø±Ø¶ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©
        function displayPrayerTimes() {
            if (!prayerTimes) return;
            
            const container = document.getElementById('prayer-times-container');
            const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            
            let html = '';
            prayers.forEach(prayer => {
                const time = prayerTimes[prayer];
                html += `
                    <div class="prayer-item" id="prayer-${prayer}">
                        <span class="prayer-name">${prayerNames[prayer]}</span>
                        <span class="prayer-time">${time}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            document.getElementById('next-prayer-info').style.display = 'block';
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
        function checkUpcomingPrayer() {
            if (!prayerTimes) return;
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            let nextPrayer = null;
            let minDiff = Infinity;
            
            prayers.forEach(prayer => {
                const [hours, minutes] = prayerTimes[prayer].split(':').map(Number);
                const prayerTime = hours * 60 + minutes;
                
                let diff = prayerTime - currentTime;
                if (diff < 0) diff += 24 * 60; // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
                
                if (diff < minDiff && diff > 0) {
                    minDiff = diff;
                    nextPrayer = prayer;
                }
            });
            
            if (nextPrayer) {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²
                nextPrayerData = {
                    name: prayerNames[nextPrayer],
                    time: prayerTimes[nextPrayer],
                    minutesLeft: minDiff
                };
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                document.getElementById('next-prayer-name').innerText = nextPrayerData.name;
                document.getElementById('next-prayer-time').innerText = nextPrayerData.time;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                const hours = Math.floor(minDiff / 60);
                const minutes = minDiff % 60;
                let timeText = '';
                if (hours > 0) timeText += `${hours} Ø³Ø§Ø¹Ø© Ùˆ `;
                timeText += `${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
                const timeString = `Ø¨Ø¹Ø¯ ${timeText}`;
                
                document.getElementById('time-until-prayer').innerText = timeString;
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²
                document.getElementById('focus-next-prayer-name').innerText = nextPrayerData.name;
                document.getElementById('focus-next-prayer-time').innerText = nextPrayerData.time;
                document.getElementById('focus-time-until').innerText = timeString;
                
                // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                prayers.forEach(p => {
                    const el = document.getElementById(`prayer-${p}`);
                    if (el) el.classList.remove('active');
                });
                const activeEl = document.getElementById(`prayer-${nextPrayer}`);
                if (activeEl) activeEl.classList.add('active');
                
                // Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ 30 Ø¯Ù‚ÙŠÙ‚Ø©
                if (minDiff <= 30 && minDiff > 29) {
                    const notificationKey = `${nextPrayer}-${new Date().toDateString()}`;
                    if (lastNotificationTime !== notificationKey) {
                        lastNotificationTime = notificationKey;
                        showPrayerNotification(prayerNames[nextPrayer], minDiff);
                    }
                }
                
                // Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª
                if (minDiff <= 1 && minDiff > 0) {
                    const notificationKey = `${nextPrayer}-now-${new Date().toDateString()}`;
                    if (lastNotificationTime !== notificationKey) {
                        lastNotificationTime = notificationKey;
                        playSound('snd_bell');
                        showPrayerNotification(prayerNames[nextPrayer], 0);
                    }
                }
            }
        }

        // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØµÙ„Ø§Ø©
        function showPrayerNotification(prayerName, minutesLeft) {
            playSound('snd_gentle');
            
            if (minutesLeft > 0) {
                // Ù‚Ø¨Ù„ Ø§Ù„ØµÙ„Ø§Ø©
                if (Notification.permission === 'granted') {
                    new Notification('ğŸ•Œ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØµÙ„Ø§Ø©', {
                        body: `ØµÙ„Ø§Ø© ${prayerName} Ø¨Ø¹Ø¯ ${minutesLeft} Ø¯Ù‚ÙŠÙ‚Ø©`,
                        icon: 'ğŸ•Œ'
                    });
                }
                alert(`ğŸ•Œ ØªÙ†Ø¨ÙŠÙ‡: ØµÙ„Ø§Ø© ${prayerName} Ø¨Ø¹Ø¯ ${minutesLeft} Ø¯Ù‚ÙŠÙ‚Ø©`);
            } else {
                // Ø¯Ø®Ù„ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©
                if (Notification.permission === 'granted') {
                    new Notification('ğŸ•Œ Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©', {
                        body: `Ø­Ø§Ù† Ø§Ù„Ø¢Ù† Ù…ÙˆØ¹Ø¯ ØµÙ„Ø§Ø© ${prayerName}`,
                        icon: 'ğŸ•Œ'
                    });
                }
                alert(`ğŸ•Œ Ø­Ø§Ù† Ø§Ù„Ø¢Ù† Ù…ÙˆØ¹Ø¯ ØµÙ„Ø§Ø© ${prayerName}`);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©
        function refreshPrayerTimes() {
            const savedCity = localStorage.getItem('selectedCity');
            if (savedCity) {
                document.getElementById('city-select').value = savedCity;
                getPrayerTimesByCity();
            } else {
                getPrayerTimes();
            }
        }

        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø­ÙØ¸ ---
        let stats = {
            today: { date: '', cycles: 0, focusTime: 0 },
            week: { cycles: 0, focusTime: 0 },
            streak: 0,
            lastUsedDate: ''
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† localStorage
        function loadStats() {
            const saved = localStorage.getItem('focusTimerStats');
            if (saved) {
                stats = JSON.parse(saved);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
                const today = new Date().toDateString();
                if (stats.today.date !== today) {
                    // ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (stats.lastUsedDate === yesterday.toDateString()) {
                        // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø³Ù„Ø³Ù„Ø©
                        stats.streak++;
                    } else if (stats.lastUsedDate !== today) {
                        // Ø§Ù†Ù‚Ø·Ø¹Øª Ø§Ù„Ø³Ù„Ø³Ù„Ø©
                        stats.streak = 0;
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                    const weekStart = new Date();
                    weekStart.setDate(weekStart.getDate() - weekStart.getDay());
                    const lastWeekStart = new Date(stats.today.date);
                    lastWeekStart.setDate(lastWeekStart.getDate() - lastWeekStart.getDay());
                    
                    if (weekStart.toDateString() !== lastWeekStart.toDateString()) {
                        // Ø£Ø³Ø¨ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
                        stats.week = { cycles: 0, focusTime: 0 };
                    }
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
                    stats.today = { date: today, cycles: 0, focusTime: 0 };
                }
            } else {
                stats.today.date = new Date().toDateString();
            }
            
            updateStatsDisplay();
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function saveStats() {
            stats.lastUsedDate = new Date().toDateString();
            localStorage.setItem('focusTimerStats', JSON.stringify(stats));
            updateStatsDisplay();
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatsDisplay() {
            document.getElementById('today-cycles').innerText = stats.today.cycles;
            document.getElementById('today-time').innerText = stats.today.focusTime;
            document.getElementById('week-cycles').innerText = stats.week.cycles;
            document.getElementById('week-time').innerText = stats.week.focusTime;
            document.getElementById('streak-days').innerText = stats.streak;
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø© Ù…ÙƒØªÙ…Ù„Ø©
        function addCompletedCycle(focusMinutes) {
            stats.today.cycles++;
            stats.today.focusTime += focusMinutes;
            stats.week.cycles++;
            stats.week.focusTime += focusMinutes;
            saveStats();
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function resetStats() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŸ')) {
                stats = {
                    today: { date: new Date().toDateString(), cycles: 0, focusTime: 0 },
                    week: { cycles: 0, focusTime: 0 },
                    streak: 0,
                    lastUsedDate: ''
                };
                saveStats();
                alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª! ğŸ”„');
            }
        }

        // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
        function shareAchievement() {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');
            
            // Ø§Ù„Ø®Ù„ÙÙŠØ©
            const gradient = ctx.createLinearGradient(0, 0, 0, 600);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 600);
            
            // Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            ctx.fillStyle = 'white';
            ctx.font = 'bold 48px Cairo, Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ¯ Ø¥Ù†Ø¬Ø§Ø²ÙŠ Ø§Ù„ÙŠÙˆÙ…', 400, 100);
            
            // Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            ctx.font = 'bold 72px Cairo, Arial';
            ctx.fillText(`${stats.today.cycles}`, 400, 220);
            ctx.font = '32px Cairo, Arial';
            ctx.fillText('Ø¯ÙˆØ±Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©', 400, 270);
            
            ctx.font = 'bold 72px Cairo, Arial';
            ctx.fillText(`${stats.today.focusTime}`, 400, 380);
            ctx.font = '32px Cairo, Arial';
            ctx.fillText('Ø¯Ù‚ÙŠÙ‚Ø© ØªØ±ÙƒÙŠØ²', 400, 430);
            
            // Ø§Ù„Ø³Ù„Ø³Ù„Ø©
            if (stats.streak > 0) {
                ctx.font = 'bold 48px Cairo, Arial';
                ctx.fillText(`ğŸ”¥ ${stats.streak} ÙŠÙˆÙ… Ù…ØªØªØ§Ù„ÙŠ`, 400, 520);
            }
            
            // ØªØ­ÙˆÙŠÙ„ Ù„ØµÙˆØ±Ø© ÙˆØªÙ†Ø²ÙŠÙ„Ù‡Ø§
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `my-focus-achievement-${new Date().toLocaleDateString('ar-EG')}.png`;
                a.click();
                URL.revokeObjectURL(url);
                alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²! ğŸ‰');
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function loadSettings() {
            const saved = localStorage.getItem('focusTimerSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('p_focus').value = settings.focusTime || 25;
                document.getElementById('p_short').value = settings.shortBreak || 5;
                document.getElementById('p_long').value = settings.longBreak || 15;
                document.getElementById('p_cycles').value = settings.cycles || 4;
                document.getElementById('p_auto').checked = settings.autoStart !== false;
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function saveSettings() {
            const settings = {
                focusTime: parseInt(document.getElementById('p_focus').value),
                shortBreak: parseInt(document.getElementById('p_short').value),
                longBreak: parseInt(document.getElementById('p_long').value),
                cycles: parseInt(document.getElementById('p_cycles').value),
                autoStart: document.getElementById('p_auto').checked
            };
            localStorage.setItem('focusTimerSettings', JSON.stringify(settings));
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Audio API ---
        let audioContext;
        let rainNoiseNode, thunderNoiseNode, windNoiseNode;
        let rainGain, thunderGain, windGain;
        let activeNatureSounds = { rain: false, thunder: false, wind: false };

        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            return audioContext;
        }

        // --- ØªÙˆÙ„ÙŠØ¯ Ø£ØµÙˆØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© ---
        function createRainSound() {
            const ctx = initAudioContext();
            
            // White noise Ù„Ù„Ù…Ø·Ø±
            const bufferSize = 2 * ctx.sampleRate;
            const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
            
            const whiteNoise = ctx.createBufferSource();
            whiteNoise.buffer = noiseBuffer;
            whiteNoise.loop = true;
            
            // ÙÙ„ØªØ± Ù„Ø¬Ø¹Ù„ Ø§Ù„ØµÙˆØª ÙŠØ´Ø¨Ù‡ Ø§Ù„Ù…Ø·Ø±
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 1000;
            
            rainGain = ctx.createGain();
            rainGain.gain.value = 0.5;
            
            whiteNoise.connect(filter);
            filter.connect(rainGain);
            rainGain.connect(ctx.destination);
            
            whiteNoise.start(0);
            return whiteNoise;
        }

        function createThunderSound() {
            const ctx = initAudioContext();
            
            const bufferSize = 2 * ctx.sampleRate;
            const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                output[i] = (Math.random() * 2 - 1) * 0.3;
            }
            
            const thunder = ctx.createBufferSource();
            thunder.buffer = noiseBuffer;
            thunder.loop = true;
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 400;
            filter.Q.value = 0.5;
            
            thunderGain = ctx.createGain();
            thunderGain.gain.value = 0.5;
            
            thunder.connect(filter);
            filter.connect(thunderGain);
            thunderGain.connect(ctx.destination);
            
            thunder.start(0);
            return thunder;
        }

        function createWindSound() {
            const ctx = initAudioContext();
            
            const bufferSize = 2 * ctx.sampleRate;
            const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                output[i] = (Math.random() * 2 - 1) * 0.4;
            }
            
            const wind = ctx.createBufferSource();
            wind.buffer = noiseBuffer;
            wind.loop = true;
            
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = 800;
            filter.Q.value = 1;
            
            windGain = ctx.createGain();
            windGain.gain.value = 0.5;
            
            wind.connect(filter);
            filter.connect(windGain);
            windGain.connect(ctx.destination);
            
            wind.start(0);
            return wind;
        }

        // --- ØªØ´ØºÙŠÙ„ Ø£ØµÙˆØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© ---
        function toggleSound(type) {
            const btn = document.getElementById('btn-' + type);
            
            if (!activeNatureSounds[type]) {
                // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                if (type === 'rain') {
                    rainNoiseNode = createRainSound();
                } else if (type === 'thunder') {
                    thunderNoiseNode = createThunderSound();
                } else if (type === 'wind') {
                    windNoiseNode = createWindSound();
                }
                
                activeNatureSounds[type] = true;
                btn.innerHTML = "â¸";
                btn.classList.add('playing');
            } else {
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª
                if (type === 'rain' && rainNoiseNode) {
                    rainNoiseNode.stop();
                    rainNoiseNode = null;
                } else if (type === 'thunder' && thunderNoiseNode) {
                    thunderNoiseNode.stop();
                    thunderNoiseNode = null;
                } else if (type === 'wind' && windNoiseNode) {
                    windNoiseNode.stop();
                    windNoiseNode = null;
                }
                
                activeNatureSounds[type] = false;
                btn.innerHTML = "â–¶";
                btn.classList.remove('playing');
            }
        }

        function setVolume(type, val) {
            const volume = parseFloat(val);
            if (type === 'rain' && rainGain) {
                rainGain.gain.value = volume;
            } else if (type === 'thunder' && thunderGain) {
                thunderGain.gain.value = volume;
            } else if (type === 'wind' && windGain) {
                windGain.gain.value = volume;
            }
        }

        // --- Ø£ØµÙˆØ§Øª Ø§Ù„Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ ---
        function playGentleSound() {
            const ctx = initAudioContext();
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);
            
            // Ù†ØºÙ…Ø© Ù„Ø·ÙŠÙØ© ÙˆÙ‡Ø§Ø¯Ø¦Ø©
            oscillator.frequency.value = 523.25; // C5
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0, ctx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, ctx.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.8);
            
            oscillator.start(ctx.currentTime);
            oscillator.stop(ctx.currentTime + 0.8);
        }

        function playBellSound() {
            const ctx = initAudioContext();
            
            // Ø¬Ø±Ø³ Ù…Ø¯Ø±Ø³Ø© - Ø¹Ø¯Ø© Ù†ØºÙ…Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ©
            const times = [0, 0.15, 0.3, 0.45];
            const frequencies = [659.25, 783.99, 659.25, 783.99]; // E5, G5, E5, G5
            
            times.forEach((time, index) => {
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.value = frequencies[index];
                oscillator.type = 'sine';
                
                const startTime = ctx.currentTime + time;
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.4, startTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                
                oscillator.start(startTime);
                oscillator.stop(startTime + 0.3);
            });
        }

        function playSound(type) {
            try {
                if (type === 'snd_gentle') {
                    playGentleSound();
                } else if (type === 'snd_bell') {
                    playBellSound();
                }
            } catch (e) {
                console.log("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", e);
            }
        }

        // --- Ø§Ù„Ø³Ø§Ø¹Ø© ---
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB', {hour12: false});
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('date').innerText = now.toLocaleDateString('ar-EG', options);
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ---
        function switchTab(tab) {
            ['pomo', 'timer', 'tasks', 'stats'].forEach(t => {
                document.getElementById(t + '-view').classList.add('hidden');
                document.getElementById('btn-' + t).classList.remove('active');
            });
            document.getElementById(tab + '-view').classList.remove('hidden');
            document.getElementById('btn-' + tab).classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            if (tab === 'stats') {
                updateStatsDisplay();
            }
        }

        // --- Ø¥ØµÙ„Ø§Ø­ Checkbox ---
        function toggleCheckbox() {
            const checkbox = document.getElementById('p_auto');
            checkbox.checked = !checkbox.checked;
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ ---
        let pTimer, pTimeLeft, pIsFocus = true, pCurrentCycle = 1, pIsPaused = false, pTotalCycles = 4;
        
        function startPomo() {
            const focusMin = parseInt(document.getElementById('p_focus').value);
            const breakMin = parseInt(document.getElementById('p_short').value);
            const cycles = parseInt(document.getElementById('p_cycles').value);
            
            if (focusMin <= 0 || breakMin <= 0 || cycles <= 0) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©");
                return;
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            saveSettings();
            
            document.getElementById('pomo-setup').classList.add('hidden');
            document.getElementById('pomo-running').classList.remove('hidden');
            pCurrentCycle = 1;
            pIsFocus = true;
            pTotalCycles = cycles;
            runPomoSession();
        }

        function runPomoSession() {
            const focusMin = parseInt(document.getElementById('p_focus').value);
            const shortBreakMin = parseInt(document.getElementById('p_short').value);
            const longBreakMin = parseInt(document.getElementById('p_long').value);
            const totalCycles = parseInt(document.getElementById('p_cycles').value);
            
            // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø§Ø­Ø© (Ù‚ØµÙŠØ±Ø© Ø£Ùˆ Ø·ÙˆÙŠÙ„Ø©)
            let breakTime = shortBreakMin;
            if (pCurrentCycle === totalCycles && !pIsFocus) {
                // Ø±Ø§Ø­Ø© Ø·ÙˆÙŠÙ„Ø© Ø¨Ø¹Ø¯ Ø¢Ø®Ø± Ø¯ÙˆØ±Ø©
                breakTime = longBreakMin;
            }
            
            pTimeLeft = (pIsFocus ? focusMin : breakTime) * 60;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ
            let statusText = "ğŸ¯ ÙˆÙ‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²";
            if (!pIsFocus) {
                statusText = pCurrentCycle === totalCycles ? "ğŸ˜Œ Ø±Ø§Ø­Ø© Ø·ÙˆÙŠÙ„Ø©" : "â˜• Ø±Ø§Ø­Ø© Ù‚ØµÙŠØ±Ø©";
            }
            
            document.getElementById('p_status_text').innerText = statusText;
            document.getElementById('cycle_display').innerText = `Ø¯ÙˆØ±Ø©: ${pCurrentCycle}/${totalCycles}`;
            
            // ğŸ”Š ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
            if (pIsFocus) {
                playSound('snd_gentle');
            } else {
                playSound('snd_bell');
            }

            clearInterval(pTimer);
            pIsPaused = false;
            document.getElementById('p_pause_btn').innerText = "â¸ Ø¥ÙŠÙ‚Ø§Ù";
            pTimer = setInterval(pTick, 1000);
            updatePomoDisplay();
            
            // ØªØ­Ø¯ÙŠØ« Ø±Ø¤ÙŠØ© ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²
            updateFocusTimerVisibility();
        }

        function pTick() {
            if (!pIsPaused) {
                pTimeLeft--;
                updatePomoDisplay();
                if (pTimeLeft <= 0) {
                    clearInterval(pTimer);
                    handlePomoEnd();
                }
            }
        }

        function handlePomoEnd() {
            if (pIsFocus) {
                // ğŸ”Š Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„ -> Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                const focusMin = parseInt(document.getElementById('p_focus').value);
                addCompletedCycle(focusMin);
                
                playSound('snd_bell');
                pIsFocus = false;
                if (document.getElementById('p_auto').checked) {
                    setTimeout(() => runPomoSession(), 2000);
                }
            } else {
                // Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø±Ø§Ø­Ø©
                const totalCycles = parseInt(document.getElementById('p_cycles').value);
                if (pCurrentCycle < totalCycles) {
                    // ğŸ”Š ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù„Ø·ÙŠÙ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    playSound('snd_gentle');
                    pCurrentCycle++;
                    pIsFocus = true;
                    if (document.getElementById('p_auto').checked) {
                        setTimeout(() => runPomoSession(), 2000);
                    }
                } else {
                    // ğŸ”Š Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
                    playSound('snd_bell');
                    setTimeout(() => {
                        alert("ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„! Ø£Ø­Ø³Ù†Øª!\n\nâœ¨ ØªÙ… Ø¥Ø¶Ø§ÙØ© " + totalCycles + " Ø¯ÙˆØ±Ø§Øª Ø¥Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ!");
                        resetPomo();
                    }, 500);
                }
            }
        }

        function updatePomoDisplay() {
            let m = Math.floor(pTimeLeft / 60);
            let s = pTimeLeft % 60;
            const timeStr = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            
            document.getElementById('p_timer_display').innerText = timeStr;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²
            const totalCycles = parseInt(document.getElementById('p_cycles').value);
            let statusLabel = "ğŸ¯ ÙˆÙ‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²";
            if (!pIsFocus) {
                statusLabel = pCurrentCycle === totalCycles ? "ğŸ˜Œ Ø±Ø§Ø­Ø© Ø·ÙˆÙŠÙ„Ø©" : "â˜• Ø±Ø§Ø­Ø© Ù‚ØµÙŠØ±Ø©";
            }
            
            document.getElementById('focus-timer-text').innerText = timeStr;
            document.getElementById('focus-timer-label').innerText = statusLabel;
            document.getElementById('focus-timer-cycle').innerText = `Ø¯ÙˆØ±Ø©: ${pCurrentCycle}/${totalCycles}`;
        }

        function togglePausePomo() {
            pIsPaused = !pIsPaused;
            const btnText = pIsPaused ? "â–¶ Ø§Ø³ØªØ¦Ù†Ø§Ù" : "â¸ Ø¥ÙŠÙ‚Ø§Ù";
            document.getElementById('p_pause_btn').innerText = btnText;
            document.getElementById('focus-pause-btn').innerText = btnText;
        }
        
        function stopFocusTimer() {
            if (pTimer) {
                resetPomo();
            } else if (tRunning) {
                resetTimerDisplay();
            }
        }
        
        function resetPomo() {
            clearInterval(pTimer);
            pIsPaused = false;
            document.getElementById('pomo-setup').classList.remove('hidden');
            document.getElementById('pomo-running').classList.add('hidden');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¹Ø±Ø¶ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²
            updateFocusTimerVisibility();
        }

        // --- ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø± ---
        let athkarInterval;
        const athkar = [
            "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡",
            "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…",
            "Ù„Ø§ Ø­ÙˆÙ„ ÙˆÙ„Ø§ Ù‚ÙˆØ© Ø¥Ù„Ø§ Ø¨Ø§Ù„Ù„Ù‡",
            "Ø§Ù„Ù„Ù‡Ù… ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø­Ù…Ø¯",
            "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ø±Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠÙ†",
            "Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡",
            "Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±",
            "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ… ÙˆØ¨Ø­Ù…Ø¯Ù‡",
            "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø¹ÙˆØ° Ø¨Ùƒ Ù…Ù† Ø§Ù„Ù‡Ù… ÙˆØ§Ù„Ø­Ø²Ù†"
        ];

        function toggleFocusMode() {
            document.body.classList.toggle('focus-active');
            
            if(document.body.classList.contains('focus-active')) {
                showAthkar();
                athkarInterval = setInterval(showAthkar, 8000);
            } else {
                clearInterval(athkarInterval);
            }
        }

        function showAthkar() {
            const el = document.getElementById('athkar-box');
            el.style.opacity = '0';
            
            setTimeout(() => {
                el.innerText = athkar[Math.floor(Math.random() * athkar.length)];
                el.style.opacity = '1';
            }, 1000);
        }

        // --- Ø§Ù„Ù…Ù‡Ø§Ù… ---
        function addTask() {
            const input = document.getElementById('task-input');
            const val = input.value.trim();
            
            if(val) {
                const li = document.createElement('li');
                li.className = 'task-item';
                
                const span = document.createElement('span');
                span.className = 'task-text';
                span.textContent = val;
                span.onclick = function() {
                    this.classList.toggle('completed');
                };
                
                const btn = document.createElement('button');
                btn.className = 'task-delete-btn';
                btn.innerHTML = 'âœ•';
                btn.onclick = function() {
                    li.remove();
                };
                
                li.appendChild(span);
                li.appendChild(btn);
                document.getElementById('task-list').appendChild(li);
                input.value = '';
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
        document.addEventListener('DOMContentLoaded', function() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            loadStats();
            loadSettings();
            
            // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            requestNotificationPermission();
            
            // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ø­ÙÙˆØ¸Ø©
            const savedCity = localStorage.getItem('selectedCity');
            if (savedCity) {
                document.getElementById('city-select').value = savedCity;
                getPrayerTimesByCity();
            }
            
            const taskInput = document.getElementById('task-input');
            if (taskInput) {
                taskInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addTask();
                    }
                });
            }
        });

        // --- Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠ ---
        let tTimer, tRunning = false, tTotalTime = 0;
        
        function handleTimerBtn() {
            if(!tRunning) {
                const min = parseInt(document.getElementById('t_min').value) || 0;
                const sec = parseInt(document.getElementById('t_sec').value) || 0;
                tTotalTime = min * 60 + sec;
                
                if(tTotalTime <= 0) {
                    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙˆÙ‚Øª ØµØ­ÙŠØ­");
                    return;
                }
                
                document.getElementById('timer-setup').classList.add('hidden');
                document.getElementById('timer-running-display').classList.remove('hidden');
                document.getElementById('t_action_btn').innerText = "â¹ Ø¥Ù„ØºØ§Ø¡";
                document.getElementById('t_action_btn').style.background = "var(--danger-color)";
                tRunning = true;
                
                // ØªØ­Ø¯ÙŠØ« Ø±Ø¤ÙŠØ© ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²
                updateFocusTimerVisibility();
                
                tTimer = setInterval(() => {
                    tTotalTime--;
                    updateTimerDisplay();
                    
                    if(tTotalTime <= 0) {
                        clearInterval(tTimer);
                        playSound('snd_bell');
                        setTimeout(() => {
                            alert('â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!');
                            resetTimerDisplay();
                        }, 500);
                    }
                }, 1000);
                
                updateTimerDisplay();
            } else {
                clearInterval(tTimer);
                resetTimerDisplay();
            }
        }
        
        function updateTimerDisplay() {
            let m = Math.floor(tTotalTime / 60);
            let s = tTotalTime % 60;
            const timeStr = `${m}:${s<10?'0'+s:s}`;
            
            document.getElementById('t_display').innerText = timeStr;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²
            document.getElementById('focus-timer-text').innerText = timeStr;
            document.getElementById('focus-timer-label').innerText = "â³ Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ";
            document.getElementById('focus-timer-cycle').innerText = "";
        }
        
        function updateFocusTimerVisibility() {
            const focusDisplay = document.getElementById('focus-timer-display');
            const focusControls = focusDisplay.querySelector('.focus-controls');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ§ÙŠÙ…Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ Ø£Ùˆ Ø§Ù„Ù…Ø¤Ù‚Øª Ø´ØºØ§Ù„
            if (pTimer || tRunning) {
                focusDisplay.classList.add('active');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                if (pTimer) {
                    focusControls.style.display = 'flex';
                    document.getElementById('focus-pause-btn').style.display = 'block';
                } else if (tRunning) {
                    focusControls.style.display = 'flex';
                    document.getElementById('focus-pause-btn').style.display = 'none';
                }
            } else {
                // Ø¥Ø®ÙØ§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„ØªØ§ÙŠÙ…Ø±
                focusDisplay.classList.remove('active');
            }
        }
        
        function resetTimerDisplay() {
            tRunning = false;
            clearInterval(tTimer);
            document.getElementById('timer-setup').classList.remove('hidden');
            document.getElementById('timer-running-display').classList.add('hidden');
            document.getElementById('t_action_btn').innerText = "â–¶ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¤Ù‚Øª";
            document.getElementById('t_action_btn').style.background = "var(--accent-color)";
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¹Ø±Ø¶ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²
            updateFocusTimerVisibility();
        }
    </script>
</body>
</html>
